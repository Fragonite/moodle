{"version":3,"file":"edit_penalty_form.min.js","sources":["../src/edit_penalty_form.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Handles edit penalty form.\n *\n * @module     gradepenalty_duedate/edit_penalty_form\n * @copyright  2024 Catalyst IT\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport * as Str from 'core/str';\nimport * as notification from 'core/notification';\n\n/**\n * Store group label string\n */\nlet groupLabel = '';\n\n/**\n * Selectors\n */\nconst SELECTORS = {\n    GROUPS: '[data-groupname]',\n    DELETE_BUTTON: '.deleterulebuttons',\n    DELETED_RULES: '[name=\"deletedrules\"]',\n    groupWithNumber: number => `[data-groupname=\"rulegroup[${number}]\"]`,\n    groupLabel: groupid => `[id=\"${groupid}_label\"]`,\n};\n\n/**\n * Update the group label with rule number.\n *\n */\nconst updateGroupLabel = () => {\n    // Get all the group elements.\n    let groups = document.querySelectorAll(SELECTORS.GROUPS);\n\n    // Update the group label with rule number.\n    let ruleNumber = 1;\n    groups.forEach((group) => {\n        // Skip if the group is hidden.\n        if (group.style.display === 'none') {\n            return;\n        }\n        let label = document.querySelector(SELECTORS.groupLabel(group.id));\n        if (label) {\n            label.textContent = groupLabel + \" \" + (ruleNumber++);\n        }\n    });\n};\n\n/**\n * Register click event for delete buttons.\n */\nconst registerEventListeners = () => {\n    // Find all delete buttons and add event listeners.\n    const deleteButtons = document.querySelectorAll(SELECTORS.DELETE_BUTTON);\n    deleteButtons.forEach(button => {\n        button.addEventListener('click', e => {\n            e.preventDefault();\n            deleteRule(e.target);\n        });\n    });\n};\n\n/**\n * Delete a rule group.\n *\n * @param {Object} target\n */\nconst deleteRule = target => {\n    // Extract the rule number from element name.\n    let name = target.getAttribute('name');\n    let rulenumber = name.match(/\\d+/)[0];\n\n    // Find the group element having the rule number.\n    let group = document.querySelector(SELECTORS.groupWithNumber(rulenumber));\n\n    // Hide the group element.\n    group.style.display = 'none';\n\n    // Update the group label.\n    updateGroupLabel();\n\n    // Add the rule number to the deleted rules input.\n    let deletedRules = document.querySelector(SELECTORS.DELETED_RULES);\n    deletedRules.value += rulenumber + ',';\n};\n\n/**\n * Initialize the js.\n */\nexport const init = () => {\n    Str.get_string('penaltyrule_group', 'gradepenalty_duedate')\n        .done(str => {\n            groupLabel = str;\n            updateGroupLabel();\n        }).fail(notification.exception);\n    registerEventListeners();\n};\n"],"names":["groupLabel","SELECTORS","number","groupid","updateGroupLabel","groups","document","querySelectorAll","ruleNumber","forEach","group","style","display","label","querySelector","id","textContent","deleteRule","target","rulenumber","getAttribute","match","value","Str","get_string","done","str","fail","notification","exception","button","addEventListener","e","preventDefault"],"mappings":";;;;;;;0KA6BIA,WAAa,SAKXC,iBACM,mBADNA,wBAEa,qBAFbA,wBAGa,wBAHbA,0BAIeC,6CAAwCA,cAJvDD,qBAKUE,wBAAmBA,oBAO7BC,iBAAmB,SAEjBC,OAASC,SAASC,iBAAiBN,kBAGnCO,WAAa,EACjBH,OAAOI,SAASC,WAEgB,SAAxBA,MAAMC,MAAMC,mBAGZC,MAAQP,SAASQ,cAAcb,qBAAqBS,MAAMK,KAC1DF,QACAA,MAAMG,YAAchB,WAAa,IAAOQ,kBAwB9CS,WAAaC,aAGXC,WADOD,OAAOE,aAAa,QACTC,MAAM,OAAO,GAGvBf,SAASQ,cAAcb,0BAA0BkB,aAGvDR,MAAMC,QAAU,OAGtBR,mBAGmBE,SAASQ,cAAcb,yBAC7BqB,OAASH,WAAa,mBAMnB,KAChBI,IAAIC,WAAW,oBAAqB,wBAC/BC,MAAKC,MACF1B,WAAa0B,IACbtB,sBACDuB,KAAKC,aAAaC,WAzCHvB,SAASC,iBAAiBN,yBAClCQ,SAAQqB,SAClBA,OAAOC,iBAAiB,SAASC,IAC7BA,EAAEC,iBACFhB,WAAWe,EAAEd"}